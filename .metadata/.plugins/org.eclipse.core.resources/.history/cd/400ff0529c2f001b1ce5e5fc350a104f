package dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import General.General;
import bean.SachBean;
import bean.loaiBean;
import bean.sachdetailBean;

public class SachDao {
	public Connection cn;

	public void ConnectSQL() throws ClassNotFoundException {
		try {
			Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");
			cn = DriverManager.getConnection(General.url, General.user, General.pass);
			System.out.println("Asccess Success");
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			System.out.println("Error: " + e.getMessage());
		}
	}

	public ArrayList<SachBean> getSach() throws SQLException, ClassNotFoundException {
		ConnectSQL();
		String sql = "SELECT * FROM sach";
		PreparedStatement cm = cn.prepareStatement(sql);
		ResultSet kq = cm.executeQuery();
		ArrayList<SachBean> listSach = new ArrayList<SachBean>();
		while (kq.next()) {
			String masach = kq.getString(1);
			String tensach = kq.getString(2);
			String tacgia = kq.getString(9);
			int gia = kq.getInt(4);
			String anh = kq.getString(7);
			String maloai = kq.getString(5);
			SachBean sach = new SachBean(masach, tensach, tacgia, gia, anh, maloai);
			listSach.add(sach);
		}

		return listSach;
	}
	
	public ArrayList<SachBean> getSachTheoMa(String ma) throws SQLException, ClassNotFoundException {
		ConnectSQL();
		String sql = "SELECT * FROM sach WHERE maloai  = '" + ma + "'";
		PreparedStatement cm = cn.prepareStatement(sql);
		ResultSet kq = cm.executeQuery();
		ArrayList<SachBean> listSach = new ArrayList<SachBean>();
		while (kq.next()) {
			String masach = kq.getString(1);
			String tensach = kq.getString(2);
			String tacgia = kq.getString(9);
			int gia = kq.getInt(4);
			String anh = kq.getString(7);
			String maloai = kq.getString(5);
			SachBean sach = new SachBean(masach, tensach, tacgia, gia, anh, maloai);
			listSach.add(sach);
		}
		return listSach;
	}
	
	public SachBean TimSachTheoMa(String ma) throws SQLException, ClassNotFoundException {
		ConnectSQL();
		String sql = "SELECT * FROM Sach WHERE masach='" + ma + "'";
		PreparedStatement cm = cn.prepareStatement(sql);
		ResultSet kq = cm.executeQuery();
		while (kq.next()) {
			String masach = kq.getString(1);
			String tensach = kq.getString(2);
			String tacgia = kq.getString(9);
			int gia = kq.getInt(4);
			String anh = kq.getString(7);
			String maloai = kq.getString(5);
			SachBean sach = new SachBean(masach, tensach, tacgia, gia, anh, maloai);
			return sach;
		}
		return null;
	}
	
	public sachdetailBean detailSach(String ma) throws SQLException, ClassNotFoundException {
		ConnectSQL();
		String sql = "SELECT * FROM Sach WHERE masach='" + ma + "'";
		PreparedStatement cm = cn.prepareStatement(sql);
		ResultSet kq = cm.executeQuery();
		while (kq.next()) {
			String masach = kq.getString(1);
			String tensach = kq.getString(2);
			String tacgia = kq.getString(9);
			int gia = kq.getInt(4);
			String anh = kq.getString(7);
			String maloai = kq.getString(5);
			String description = kq.getString(9);
			sachdetailBean sach = new sachdetailBean(masach, tensach, tacgia, gia, anh, maloai, description);
			return sach;
		}
		return null;
	}
}
